---
title: 八股文-mysql
categories:
  - 数据库
tags:
  - 面试
date: 2023-08-25 08:13:17
---

# 前言

整理mysql的相关面试题，题目来源微信公众号。

# 题目

## 数据库的常用存储引擎有哪些？能重点介绍innodb和myisam的区别？

### innodb

InnoDB存储引擎支持事务，其设计目标主要面向在线事务处理（OLTP）的应用。其特点是行锁设计、支持外键，并支持类似于Oracle的非锁定读，即默认读取操作不会产生锁。从MySQL数据库5.5.8版本开始，InnoDB存储引擎是默认的存储引擎。
InnoDB通过使用多版本并发控制（MVCC）来获得高并发性，并且实现了SQL标准的4种隔离级别，默认为REPEATABLE级别。同时，使用一种被称为next-keylocking的策略来避免幻读（phantom）现象的产生。除此之外，InnoDB储存引擎还提供了插入缓冲缓冲（insertbuffer）、二次写（doublewrite）、自适应哈希索引（adaptivehashindex）、预读（readahead）等高性能和高可用的功能。对于表中数据的存储，InnoDB存储引擎采用了聚集（clustered）的方式，因此每张表的存储都是按主键的顺序进行存放。如果没有显式地在表定义时指定主键，InnoDB存储引擎会为每一行生成一个6字节的ROWID，并以此作为主键。

### MyISAM

MyISAM存储引擎不支持事务、表锁设计，支持全文索引，主要面向一些OLAP数据库应用。
此外，MyISAM存储引擎的另一个与众不同的地方是它的缓冲池只缓存（cache）索引文件，而不缓冲数据文件，这点和大多数的数据库都非常不同。

### NDB

纯内存存储引擎

### 比较

除非有非常特别的原因需要使用其他的存储引擎，否则应该优先考虑InnoDB引擎。对于只读的数据，或者表比较小，可以忍受修复操作，则依然可以使用MyISAM（但请不要默认使用MyISAM，而是应该默认使用InnoDB）。

参考：
[Mysql 中 MyISAM 和 InnoDB 的区别有哪些？](https://www.zhihu.com/question/20596402/answer/529312016) 
《MySQL技术内幕：InnoDB存储引擎(第2版)》 姜承尧 机械工业出版社

## B+树和hash索引的区别是什么？

B+树多层，hash索引一层加链表

B+树是树，hash索引不是

hash索引复杂度O1，B+树更高

哈希索引只能用来搜索等值的查询，B+树可以范围查找

自适应哈希索引是由InnoDB存储引擎自己控制的，DBA本身并不能对其进行干预，B+树索引可以人为设定。

参考：
《MySQL技术内幕：InnoDB存储引擎(第2版)》 姜承尧 机械工业出版社


## 索引在什么时候会失效？

在某些情况下，当执行EXPLAIN命令进行SQL语句的分析时，会发现优化器并没有选择索引去查找数据，而是通过扫描聚集索引，也就是直接进行全表的扫描来得到数据。这种情况多发生于范围查找、JOIN链接操作等情况下。

参考：
《MySQL技术内幕：InnoDB存储引擎(第2版)》 姜承尧 机械工业出版社

## 了解聚集索引和非聚集索引的区别么？覆盖索引是什么？

聚集索引（clustered index）就是按照每张表的主键构造一棵B+树，同时叶子节点中存放的即为整张表的行记录数据，也将聚集索引的叶子节点称为数据页。

辅助索引（Secondary Index，也称非聚集索引），叶子节点并不包含行记录的全部数据。叶子节点除了包含键值以外，每个叶子节点中的索引行中还包含了一个书签（bookmark）。该书签用来告诉InnoDB存储引擎哪里可以找到与索引相对应的行数据。由于InnoDB存储引擎表是索引组织表，因此InnoDB存储引擎的辅助索引的书签就是相应行数据的聚集索引键。

![聚集索引和非聚集索引](./2023-08-25-八股文-mysql/聚集索引和非聚集索引.png)

辅助索引的存在并不影响数据在聚集索引中的组织，因此每张表上可以有多个辅助索引。当通过辅助索引来寻找数据时，InnoDB存储引擎会遍历辅助索引并通过叶级别的指针获得指向主键索引的主键，然后再通过主键索引来找到一个完整的行记录。举例来说，如果在一棵高度为3的辅助索引树中查找数据，那需要对这棵辅助索引树遍历3次找到指定主键，如果聚集索引树的高度同样为3，那么还需要对聚集索引树进行3次查找，最终找到一个完整的行数据所在的页，因此一共需要6次逻辑IO访问以得到最终的一个数据页。

InnoDB存储引擎支持覆盖索引（covering index，或称索引覆盖），即从辅助索引中就可以得到查询的记录，而不需要查询聚集索引中的记录。使用覆盖索引的一个好处是辅助索引不包含整行记录的所有信息，故其大小要远小于聚集索引，因此可以减少大量的IO操作。覆盖索引可以理解为辅助索引的特殊的用法。

参考：
《MySQL技术内幕：InnoDB存储引擎(第2版)》 姜承尧 机械工业出版社

## B+树的优点是什么？为什么mysql的索引使用b+树，为什么不使用B树或者红黑树呢？

- B+树的特征

有m个子树的中间节点包含有m个元素（B树中是k-1个元素），每个元素不保存数据，只用来索引；
所有的叶子结点中包含了全部关键字的信息，及指向含有这些关键字记录的指针，且叶子结点本身依关键字的大小自小而大的顺序链接。 (而B 树的叶子节点并没有包括全部需要查找的信息)；
所有的非终端结点可以看成是索引部分，结点中仅含有其子树根结点中最大（或最小）关键字。 (而B 树的非终节点也包含需要查找的有效信息)；

- 为什么说B+树比B树更适合数据库索引

1）B+树的磁盘读写代价更低

　　B+树的内部结点并没有指向关键字具体信息的指针。因此其内部结点相对B树更小。如果把所有同一内部结点的关键字存放在同一盘块中，那么盘块所能容纳的关键字数量也越多。一次性读入内存中的需要查找的关键字也就越多。相对来说IO读写次数也就降低了；

2）B+树查询效率更加稳定

　　由于非终结点并不是最终指向文件内容的结点，而只是叶子结点中关键字的索引。所以任何关键字的查找必须走一条从根结点到叶子结点的路。所有关键字查询的路径长度相同，导致每一个数据的查询效率相当；

3）B+树便于范围查询（最重要的原因，范围查找是数据库的常态）

　　B树在提高了IO性能的同时并没有解决元素遍历的我效率低下的问题，正是为了解决这个问题，B+树应用而生。B+树只需要去遍历叶子节点就可以实现整棵树的遍历。而且在数据库中基于范围的查询是非常频繁的，而B树不支持这样的操作或者说效率太低；

- 相比红黑树的优势

红黑树的出度为2，B+树的出度一般非常大，B+树会明显低很多，有利于减少IO次数。

参考：
[B树、B+树详解](https://www.cnblogs.com/lianzhilei/p/11250589.html)
[MySQL](https://www.cyc2018.xyz/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html)
[图解：什么是B树？](https://zhuanlan.zhihu.com/p/146252512)




锁
3.Innodb的行锁有哪几种？分别是怎么实现的？
csnote
4.数据库的乐观锁和悲观锁的区别？Select*from table for update，select *from table in share mode分别加的是什么锁？
https://zhuanlan.zhihu.com/p/100703597?utm_id=0

13. 数据库会死锁么？Innodb是怎么解决死锁的？
6.7
14. 如何安全的更改一行数据？
？

事务
6. Mysql的事务有那几个特性？ACID分别是怎么实现的？
7.1.1
有几种隔离级别？分别是怎么实现的？默认的隔离级别是？
7.6
11. 什么是幻读？Mysql的innodb存储引擎是怎么解决幻读的？


调优
12. Mysql怎么优化，explain指令有了解过？索引怎么创建比较合适？
15. In和exist的区别是什么？

主备
7. Mysql是怎么实现主备同步的？同步的方式有几种？涉及到的三个线程分别怎么工作？
8.7
分库分表
8. 你们项目有使用分库分表？如何实现？如果要扩数据库节点的话，怎么实现？
csnote 博客 无
数据库
16. left join、right join，inner join的区别是什么？
csnote
10. 数据库的三大范式是什么？最左前缀原则是什么？如果table有a，b有联合索引，那么Select *from table where a>0 and b=0 ; Select *from table where a=0 and b>0两个sql语句是否有使用索引？
csnote

## Redis的高性能体现在哪些方面？

1. 纯内存访问
2. 非阻塞I/O，Redis使用epoll作为I/O多路复用技术的实现，再加上Redis自身的事件处理模型将epoll中的连接、读写、关闭都转换为事件，不在网络I/O上浪费过多的时间
3. 单线程避免了线程切换和竞态产生的消耗

参考：
《Redis开发与运维》 付磊　张益军 机械工业出版社

# 参考

[微信公众号:我的IT技术路](https://mp.weixin.qq.com/s/54_bMeUwjxk-8DHa90heNQ)